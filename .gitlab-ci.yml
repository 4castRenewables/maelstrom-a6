stages:
 - lint
 - test

image:
  name: mquade/poetry:3.9-1.2.0a2
  entrypoint: [""]

.lint:
  stage: lint
  before_script:
    - poetry install -E linting

black:
  extends: .lint
  script:
    - poetry run black --config pyproject.toml --check .


flake8:
  extends: .lint
  script:
    - poetry run flake8 --config pyproject.toml .


reorder-imports:
  extends: .lint
  script:
    - poetry run reorder-python-imports --application-directories=.:src


test:
  stage: test
  before_script:
    - poetry install
  script:
    - poetry run pytest --junitxml=report.xml src/tests/unit
  artifacts:
    when: always
    reports:
      junit: report.xml
